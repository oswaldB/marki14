---
// src/components/SideMenu.astro
// Composant de menu latéral simplifié avec HTML statique

interface Props {
  currentPath?: string;
}

const { currentPath = '' } = Astro.props;

// Import des icônes Lucide
import { FileText, ListOrdered, Mail, Settings, List, Users, LayoutGrid, User, AlertTriangle, BarChart2, Menu as MenuIcon, ChevronDown, X, Filter, Inbox, FileText as Description, LayoutDashboard, BanknoteX, HandCoins, Send } from '@lucide/astro';
---

<script is:inline>
  // Initialisation Alpine.js pour le menu rétractable avec localStorage
  // Solution inline qui ne dépend pas de fonctions globales
  if (typeof window !== 'undefined') {
    // Lire l'état initial depuis localStorage
    let initialState = true;
    try {
      if (window.localStorage) {
        const storedValue = localStorage.getItem('impayesMenuOpen');
        initialState = storedValue !== null ? JSON.parse(storedValue) : true;
      }
    } catch (e) {
      console.warn('LocalStorage not available, using default state');
    }
    
    // Définir la variable globale pour que Alpine puisse y accéder
    window.__impayesMenuState = initialState;
  }
</script>
<!-- Desktop: Double Sidebar Layout -->
<div class="hidden md:flex h-full w-full relative" x-data="{
  isImpayesOpen: typeof window !== 'undefined' && window.__impayesMenuState !== undefined ? window.__impayesMenuState : true,
  
  toggleImpayes() {
    this.isImpayesOpen = !this.isImpayesOpen;

      if (typeof window !== 'undefined' && window.localStorage) {
        localStorage.setItem('impayesMenuOpen', JSON.stringify(this.isImpayesOpen));
      }
    
  }
}">
  <!-- First Column - Icon-only sidebar -->
  <div class="w-16 bg-white border-r border-gray-200 flex flex-col items-center py-4 h-full shadow-sm relative">
    <div class="mb-6">
      <img src="/marki-logo.png" alt="Marki Logo" class="w-10 h-10 transition-transform hover:scale-105" />
    </div>

    <div class="flex flex-col space-y-3 flex-1">
      <!-- Dashboard -->
      <a
        href="/dashboard"
        class="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-all duration-200 transform hover:scale-105"
        title="Dashboard"
      >
        <LayoutDashboard class="" />
      </a>
      
      <!-- Impayés parent -->
      <div class="relative group">
        <button
          class="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-all duration-200 transform hover:scale-105"
          title="Impayés"
          @click="toggleImpayes()"
        >
          <BanknoteX class="" />
        </button>
      </div>
      
      <!-- Commissions -->
      <a
        href="/commissions"
        class="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-all duration-200 transform hover:scale-105"
        title="Commissions"
      >
        <HandCoins class="" />
      </a>
      
      <!-- Paramètres -->
      <a
        href="/settings"
        class="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-all duration-200 transform hover:scale-105"
        title="Paramètres"
      >
        <Settings class="" />
      </a>
    </div>
  </div>
  
  <!-- Second Column - Full menu sidebar -->
  <div class="flex-1 bg-white border-r border-gray-200 flex-shrink-0 shadow-sm relative">
    <div class="p-4 border-b border-gray-100">
      <h2 class="text-xl font-semibold text-gray-800">IMPAYÉS</h2>
    </div>
    
    <nav class="px-2 py-3">
      <ul class="space-y-1">
        <!-- Impayés parent with children -->
        <li>
          <div>
            <button
              class="flex items-center justify-between w-full gap-3 rounded-md px-3 py-2.5 hover:bg-gray-100 text-gray-600 transition-all duration-200"
              @click="toggleImpayes()"
            >
              <div class="flex items-center gap-3">
                <BanknoteX class="" />
                <span class="font-medium">Impayés</span>
              </div>
              <ChevronDown class="transition-transform" :class="{ 'rotate-180': isImpayesOpen }" />
            </button>
            <ul class="ml-4 mt-1 space-y-1" x-show="isImpayesOpen" x-transition>
              <li>
                <a
                  href="/impayes/list"
                  class="flex items-center gap-3 rounded-md px-3 py-2 hover:bg-gray-100 text-gray-600 transition-all duration-150 text-sm"
                >
                  <List class="text-base" />
                  <span class="text-sm">Vue Factures</span>
                </a>
              </li>
              <li>
                <a
                  href="/impayes/"
                  class="flex items-center gap-3 rounded-md px-3 py-2 hover:bg-gray-100 text-gray-600 transition-all duration-150 text-sm"
                >
                  <Users class="text-base" />
                  <span class="text-sm">Groupé par payeur</span>
                </a>
              </li>
              <li>
                <a
                  href="/impayes/sequence"
                  class="flex items-center gap-3 rounded-md px-3 py-2 hover:bg-gray-100 text-gray-600 transition-all duration-150 text-sm"
                >
                  <LayoutGrid class="text-base" />
                  <span class="text-sm">Vue Séquence</span>
                </a>
              </li>
              <li>
                <a
                  href="/impayes/by-actor"
                  class="flex items-center gap-3 rounded-md px-3 py-2 hover:bg-gray-100 text-gray-600 transition-all duration-150 text-sm"
                >
                  <User class="text-base" />
                  <span class="text-sm">Vue par Acteur</span>
                </a>
              </li>
              <li>
                <a
                  href="/impayes/to-fix"
                  class="flex items-center gap-3 rounded-md px-3 py-2 hover:bg-gray-100 text-gray-600 transition-all duration-150 text-sm"
                >
                  <AlertTriangle class="text-base" />
                  <span class="text-sm">À réparer</span>
                </a>
              </li>
            </ul>
          </div>
        </li>
        
        <!-- Other menu items -->
        <li>
          <a
            href="/sequences"
            class="flex items-center gap-3 rounded-md px-3 py-2.5 hover:bg-gray-100 text-gray-600 transition-all duration-200 font-medium"
          >
            <ListOrdered class="" />
            <span>Séquences</span>
          </a>
        </li>
        
        <li>
          <a
            href="/relances"
            class="flex items-center gap-3 rounded-md px-3 py-2.5 hover:bg-gray-100 text-gray-600 transition-all duration-200 font-medium"
          >
            <Send class="" />
            <span>Relances</span>
          </a>
        </li>
        
        <li>
          <a
            href="/settings"
            class="flex items-center gap-3 rounded-md px-3 py-2.5 hover:bg-gray-100 text-gray-600 transition-all duration-200 font-medium"
          >
            <Settings class="" />
            <span>Paramètres</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- Mobile: Dock Layout - Version optimisée pour le dock -->
<div class="block md:hidden w-full">
  <!-- Mobile Menu - Optimisé pour le dock -->
  <div class="w-full max-w-md mx-auto">
    <nav class="dock-mobile-nav flex items-center justify-center space-x-2 dock-content pb-2">
      <!-- Boutons de navigation principaux -->
      <a
        href="/dashboard"
        class="flex flex-col items-center justify-center p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-all duration-200 min-w-[60px]"
        title="Dashboard"
      >
        <LayoutDashboard class="text-lg mb-1" />
        <span class="text-xs font-medium">Dashboard</span>
      </a>
      
      <a
        href="/impayes/list"
        class="flex flex-col items-center justify-center p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-all duration-200 min-w-[60px]"
        title="Factures"
      >
        <List class="text-lg mb-1" />
        <span class="text-xs font-medium">Factures</span>
      </a>
      
      <a
        href="/sequences"
        class="flex flex-col items-center justify-center p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-all duration-200 min-w-[60px]"
        title="Séquences"
      >
        <LayoutGrid class="text-lg mb-1" />
        <span class="text-xs font-medium">Séquences</span>
      </a>
      
      <a
        href="/relances"
        class="flex flex-col items-center justify-center p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-all duration-200 min-w-[60px]"
        title="Relances"
      >
        <Send class="text-lg mb-1" />
        <span class="text-xs font-medium">Relances</span>
      </a>
      
      <a
        href="/settings"
        class="flex flex-col items-center justify-center p-2 rounded-lg hover:bg-gray-100 text-gray-600 transition-all duration-200 min-w-[60px]"
        title="Paramètres"
      >
        <Settings class="text-lg mb-1" />
        <span class="text-xs font-medium">Paramètres</span>
      </a>
    </nav>
  </div>
</div>



<style is:global>
  /* Ensure sidebar is not fixed position */
  aside .hidden.md\:flex {
    position: relative !important;
  }
  
  /* Mobile submenu styling */
  .md\:hidden [x-show="Object.values(openMenus).some(open => open)"] {
    transition: transform 0.3s ease-in-out;
  }
  
  /* Mobile dock background */
  .md\:hidden .fixed.bottom-0 {
    background: linear-gradient(to top, #f8fafc 0%, rgba(248, 250, 252, 0.95) 100%);
  }
  
  /* Mobile dock item hover effect */
  .md\:hidden .hover\:bg-gray-200:hover {
    background-color: #f1f5f9;
  }
  
  /* Collapsed dock styles */
  .md\:hidden .min-height-60 {
    min-height: 60px !important;
  }
  
  .md\:hidden .min-height-12 {
    min-height: 12px !important;
  }
  
  /* Transition for dock collapse/expand */
  .md\:hidden .transition-all {
    transition: all 0.3s ease-in-out;
  }
  
  /* Dock item opacity transition */
  .md\:hidden .opacity-0 {
    opacity: 0;
  }
  
  .md\:hidden .opacity-100 {
    opacity: 1;
  }
  
  .md\:hidden .pointer-events-none {
    pointer-events: none;
  }
  
  /* Mobile submenu scrollbar */
  .md\:hidden .max-h-80::-webkit-scrollbar {
    width: 4px;
  }
  
  .md\:hidden .max-h-80::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 2px;
  }
  
  .md\:hidden .max-h-80::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 2px;
  }
  
  /* Animation pour la rotation de l'icône */
  .rotate-180 {
    transform: rotate(180deg);
    transition: transform 0.3s ease;
  }
</style>
