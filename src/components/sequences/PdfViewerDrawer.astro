---
// src/components/sequences/PdfViewerDrawer.astro
import { X, Download, Camera } from '@lucide/astro';
---
<script is:inline>
  document.addEventListener('alpine:init', () => {
    Alpine.store('pdfViewer', {
      isOpen: false,
      currentPdfUrl: null,
      currentInvoiceId: null,
      
      open(invoiceId, pdfUrl) {
        this.isOpen = true;
        this.currentInvoiceId = invoiceId;
        this.currentPdfUrl = pdfUrl;
      },
      
      close() {
        this.isOpen = false;
        this.currentPdfUrl = null;
        this.currentInvoiceId = null;
      }
    });
    
    console.log('Store pdfViewer initialisé avec succès !');
  });
</script>

<!-- PDF Viewer Drawer -->
<div x-data>
  <div 
    x-show="$store.pdfViewer.isOpen"
    x-transition
    class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-end"
    data-pdf-viewer-drawer
  >
    <div class="bg-white h-full w-full md:w-1/2 shadow-xl relative" data-pdf-viewer-content>
      <div class="p-4 border-b border-gray-200 flex justify-between items-center" data-pdf-header>
        <h3 class="text-lg font-semibold text-gray-900">Facture PDF</h3>
        <button 
          @click="$store.pdfViewer.close()"
          class="text-gray-500 hover:text-gray-700"
          data-pdf-close
        >
          <X class="w-4 h-4" />
          Fermer
        </button>
      </div>
      
      <div class="p-4 h-[calc(100%-60px)] overflow-auto" data-pdf-display>
        <div x-show="!$store.pdfViewer.currentPdfUrl" class="text-center py-12">
          <p class="text-gray-500">Aucun PDF disponible pour cette facture</p>
          <p class="text-sm text-gray-400 mt-2">Facture #<span x-text="$store.pdfViewer.currentInvoiceId"></span></p>
        </div>
        
        <div x-show="$store.pdfViewer.currentPdfUrl" class="h-full flex flex-col">
          <div class="mb-4">
            <h4 class="font-semibold text-gray-900">Facture PDF</h4>
            <p class="text-sm text-gray-600">Facture #<span x-text="$store.pdfViewer.currentInvoiceId"></span></p>
          </div>
          
          <div class="flex-1 border border-gray-200 rounded-md overflow-hidden">
            <iframe 
              x-bind:src="$store.pdfViewer.currentPdfUrl"
              class="w-full h-full"
              frameborder="0"
              allowfullscreen
            ></iframe>
          </div>
        </div>
      </div>
      
      <div class="p-4 border-t border-gray-200 flex justify-end gap-2" data-pdf-controls>
        <button 
          x-show="$store.pdfViewer.currentPdfUrl"
          @click="window.open($store.pdfViewer.currentPdfUrl, '_blank')"
          class="px-3 py-1 bg-[#007ACE] text-white rounded-md hover:bg-[#006BCE] flex items-center space-x-1"
        >
          <Download class="w-4 h-4" />
          <span>Télécharger</span>
        </button>
        <button 
          x-show="$store.pdfViewer.currentPdfUrl"
          @click="window.print()"
          class="px-3 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 flex items-center space-x-1"
        >
          <Camera class="w-4 h-4" />
          <span>Imprimer</span>
        </button>
      </div>
    </div>
  </div>
</div>