<!--
  Page: sequences.astro
  Description: Page pour afficher la liste des séquences avec leurs informations
  User Story: US001 - Afficher la liste des séquences avec leurs informations
-->

---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="Liste des Séquences">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-8">Liste des Séquences</h1>

    <!-- Contenu principal sera chargé par Alpine.js -->
    <div id="sequences-app" x-data="sequencesMain()" x-init="init()">
      <!-- Indicateur de chargement -->
      <div x-show="state.loading" class="flex justify-center items-center py-8">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#007ACE]"></div>
      </div>

      <!-- Message d'erreur -->
      <div x-show="state.error" class="bg-red-50 border border-red-200 rounded-md p-4 mb-6">
        <div class="flex">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
            </svg>
          </div>
          <div class="ml-3">
            <p class="text-sm font-medium text-red-800">Erreur</p>
            <p class="text-sm text-red-700" x-text="state.error"></p>
          </div>
        </div>
        <button @click="fetchSequences()" class="mt-4 bg-[#007ACE] text-white px-4 py-2 rounded-md hover:bg-[#006BCE] transition-colors">
          Réessayer
        </button>
      </div>

      <!-- Tableau des séquences -->
      <div x-show="!state.loading && !state.error" class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Nom
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Statut
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Peuplement
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Nombre de relances
                </th>
                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Action
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <template x-for="sequence in state.sequences" :key="sequence.id">
                <tr @click="redirectToSequenceDetail(sequence.id, sequence.typePeuplement)" class="cursor-pointer hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="sequence.nom"></td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span x-text="sequence.statut ? 'Actif' : 'Inactif'" :class="sequence.statut ? 'bg-[#00CF9B] text-white' : 'bg-gray-500 text-white'" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"></span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="sequence.typePeuplement"></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="sequence.relancesCount"></td>
                  <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button class="text-[#007ACE] hover:text-[#006BCE]">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 20h9"/>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                      </svg>
                    </button>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts Alpine.js -->
  <script type="module">
    import { sequencesMain } from '/js/pages/sequences/sequences-main.js';
  </script>
</BaseLayout>

<style>
  /* Styles spécifiques à la page si nécessaire */
</style>