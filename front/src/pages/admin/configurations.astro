<---
import BaseLayout from '../../layouts/BaseLayout.astro';
--->

<BaseLayout
  title="Gestion des Configurations"
  withAuth={true}
  Alpinefile="/js/states/configurations/configListState.js"
>
  <div class="container mx-auto px-4 py-8" x-data="configListState()">
    <!-- Header avec boutons d'action -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
      <h1 class="text-3xl font-bold text-gray-900 mb-4 md:mb-0">Configurations de Synchronisation</h1>
      <div class="flex flex-wrap gap-3">
        <button
          class="bg-[#007ACE] text-white px-4 py-2 rounded-md hover:bg-[#006BCE] transition-colors flex items-center"
          @click="navigateTo('/admin/configurations/new')"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Nouvelle Configuration
        </button>
        <button
          class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 transition-colors flex items-center"
          @click="refreshConfigurations()"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
            <polyline points="23 4 23 10 17 10"></polyline>
            <polyline points="1 20 1 14 7 14"></polyline>
            <path d="M3.3 10.5L10.5 3.3 7.7 0.5"></path>
            <path d="M14.2 16.4L21.4 9.2 18.6 6.4"></path>
          </svg>
          Rafraîchir
        </button>
      </div>
    </div>

    <!-- Filtres -->
    <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm mb-6">
      <div class="flex flex-col md:flex-row gap-4">
        <input
          type="text"
          placeholder="Rechercher..."
          class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#007ACE] focus:border-transparent"
          x-model="searchQuery"
          @input.debounce.500ms="applyFilters()"
        >
        <select
          class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#007ACE] focus:border-transparent"
          x-model="statusFilter"
          @change="applyFilters()"
        >
          <option value="">Tous les statuts</option>
          <option value="Activé">Activé</option>
          <option value="Désactivé">Désactivé</option>
        </select>
      </div>
    </div>

    <!-- Tableau des configurations -->
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nom</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Base de données</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fréquence</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dernière exécution</th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <template x-for="config in filteredConfigurations" :key="config.objectId">
              <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="config.name"></td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="config.dbConfig.database"></td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="config.frequency"></td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span
                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                    :class="config.status === 'Activé' ? 'bg-[#00CF9B] text-white' : 'bg-red-500 text-white'"
                    x-text="config.status"
                  ></span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  <span x-text="config.updatedAt ? new Date(config.updatedAt.iso).toLocaleString() : 'Jamais' "></span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <button
                    class="text-[#007ACE] hover:text-[#006BCE] mr-2"
                    @click="editConfig(config.objectId)"
                    title="Éditer"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 20h9"></path>
                      <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                    </svg>
                  </button>
                  <button
                    class="text-green-500 hover:text-green-600 mr-2"
                    @click="testConfig(config.objectId)"
                    title="Tester"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                  </button>
                  <button
                    class="text-red-500 hover:text-red-600"
                    @click="deleteConfig(config.objectId)"
                    title="Supprimer"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  </button>
                </td>
              </tr>
            </template>
            <tr x-show="filteredConfigurations.length === 0">
              <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                Aucune configuration trouvée
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination -->
    <div class="mt-4 flex justify-between items-center">
      <div class="text-sm text-gray-600">
        <span x-text="`${(currentPage - 1) * itemsPerPage + 1} - ${Math.min(currentPage * itemsPerPage, totalConfigurations)} sur ${totalConfigurations}`"></span>
      </div>
      <div class="flex gap-2">
        <button
          class="px-3 py-1 border border-gray-300 rounded-md text-sm hover:bg-gray-50"
          :disabled="currentPage === 1"
          @click="previousPage()"
        >
          Précédent
        </button>
        <button
          class="px-3 py-1 border border-gray-300 rounded-md text-sm hover:bg-gray-50"
          :disabled="currentPage * itemsPerPage >= totalConfigurations"
          @click="nextPage()"
        >
          Suivant
        </button>
      </div>
    </div>
  </div>
</BaseLayout>